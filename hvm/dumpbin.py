from pwn import xor,u32
from arc4 import ARC4

sus = b"*#37([@AF+ .  _YB@3!-=7W][C59,>*@U_Zpsumloremips"
#"mipsumloremipsumloremips"
print(xor(sus,b"loremipsum").replace(b'\x00',b''))
f = open('tmp','rb')
part16= b'\xbc\x00\x80\xfa\x0f\x01\x16&\r\x0f \xc0f\x83\xc8\x01\x0f"\xc0\xea\x18\x00\x08\x00f\xb8\x10\x00\x8e\xd8\x8e\xe0\x8e\xe8\x8e\xd0\xe8\x0e\x00\x00\x00\x0f\x01\x15D\r\x00\x00\xea\xf2\x0c\x00\x00\x08\x00\xbf\x000\x00\x00\x0f"\xdf1\xc0\xb9\x00\x10\x00\x00\xf3\xab\x0f \xd8\xc7\x00\x03@\x00\x00\x05\x00\x10\x00\x00\xc7\x00\x03P\x00\x00\x05\x00\x10\x00\x00\xc7\x00\x03`\x00\x00\x05\x00\x10\x00\x00\xbb\x03\x00\x00\x00\xb9\x00\x02\x00\x00\x89\x18\x83\xc0\x08\x81\xc3\x00\x10\x00\x00\xe2\xf3\xb9\x80\x00\x00\xc0\x0f2\r\x00\x01\x00\x00\x0f0\x0f \xe7\x83\xcf \x0f"\xe7\x0f \xc7\x81\xcf\x00\x00\x00\x80\x0f"\xc7\xc3'

bin_ = part16
i = 0
while True:
    t = f.read(12)
    bin_ += t
    if t==b'' or not (t.startswith(b'\x49\xb8') and t.endswith(b'\x41\xb9')):
        bin_ += f.read()
        break
    key = t[2:10]
    x = f.read(4)
    bin_ += x
    size = u32(x)
    arc = ARC4(key)
    bin_ += f.read(2)
    buf = f.read(size)
    buf = arc.decrypt(buf)
    bin_ += buf
    bin_ += f.read(19)
    print(i)
    i+=1
f.close()
with open('sus.bin','wb') as fw:
    print(fw.write(bin_))